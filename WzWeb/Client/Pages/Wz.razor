@page "/wz"
@using WzWeb.Shared
@using Microsoft.AspNetCore.WebUtilities
@inject HttpClient Http
@inject NavigationManager NavigationManager;

@if (node == null)
{
    <Loading></Loading>
}
else
{
    <div class="row">
        <div class="col-sm-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item active" aria-current="page">@node.Text</li>
                </ol>
            </nav>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-2">
            <NodeList CurrentNode="@node"></NodeList>
        </div>
        @if (node.Type == NodeType.Wz_File)
        {
            <div class="col-sm-5">
                <FileTable CurrentNode=@node></FileTable>
            </div>
        }
        @if (node.Type == NodeType.Wz_Normal)
        {
            <div class="col-sm-5">
                <dl>
                    <div class="col-sm-5">
                        <dt> @node.Text </dt>
                    </div>
                    <div class="col-sm-7">
                        <dd class="text-break"> @node.Value </dd>
                    </div>
                </dl>
            </div>
        }
    </div>
}

@code {

    private string path;

    private Node node;

    protected override async Task OnInitializedAsync()
    {
        var query = new Uri(NavigationManager.Uri).Query;

        if (QueryHelpers.ParseQuery(query).TryGetValue("path", out var value))
        {
            path = value;
        }

        path = path ?? "Base";
        node = await Http.GetFromJsonAsync<Node>($"Maple/GetNode?path={path}");
    }

}
